sap.ui.define(["epta/ps/views/project/Project.controller","sap/ui/model/json/JSONModel","epta/ps/model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,i,o,r){"use strict";return e.extend("epta.ps.views.project.fragments.resourceManagement.ResourceManagement",{formatter:i,onInit:function(){this.setModel(new t,"_activity");this.setModel(new t,"_activityPredecessors");this.setModel(new t,"_networkPredecessors");this._initActivityModel();this._controller=this.getView().getControllerName()},onBeforeRendering:function(){this.getModel("layout").setProperty("/footer/save",true);this.getModel("layout").setProperty("/footer/cancel",true);this.getModel("layout").setProperty("/footer/filter",false);this.getModel("layout").setProperty("/footer/enabled",true)},handleValueHelpWorkCenter:function(e){var t=e.getSource().getParent().oBindingContexts;this._oInputBinding=t[Object.keys(t)[0]];if(!this._oWCDialog){this._oWCDialog=sap.ui.xmlfragment("epta.ps.views.project.fragments.resourceManagement.fragments.DialogWorkCenter",this);this.getView().addDependent(this._oWCDialog)}this._oWCDialog.attachAfterClose(function(e){e.getSource().getContent()[0].removeSelections()});this._oWCDialog.open()},handleSearchWorkCenter:function(e){var t=e.getParameter("newValue");var i=[];if(t){i=new o({filters:[new o("WorkCenter",r.Contains,t),new o("Description",r.Contains,t)],and:false})}var n=e.getSource().getParent().getParent().getContent()[0].getBinding("items");n.filter([i])},handleValueHelpVendor:function(e){var t=e.getSource().getParent().oBindingContexts;this._oInputBinding=t[Object.keys(t)[0]];if(!this._oVDialog){this._oVDialog=sap.ui.xmlfragment("epta.ps.views.project.fragments.resourceManagement.fragments.DialogVendor",this);this.getView().addDependent(this._oVDialog)}this._oVDialog.attachAfterClose(function(e){e.getSource().getContent()[0].removeSelections()});this._oVDialog.open()},handleSearchVendor:function(e){var t=e.getParameter("newValue");var i=[];if(t){i=new o({filters:[new o("ID",r.Contains,t),new o("Name",r.Contains,t)],and:false})}var n=e.getSource().getParent().getParent().getContent()[0].getBinding("items");n.filter([i])},handleAddActivity:function(e){var t=this;var i=e.getSource().getParent().oBindingContexts;this._oSelectedItem=i[Object.keys(i)[0]];var o=this._oSelectedItem.oModel.getProperty(this._oSelectedItem.sPath);var r=this.getModel("NetworkActivity").getData();var n="";var a=[{Network:"",Description:""}];var s=[];r.forEach(function(e){if(e.Network!==""&&s.indexOf(e.Network)<0){s.push(e.Network)}});s.sort();s.forEach(function(e){a.push({Network:e,Description:t.getModel("NetworkActivity").getData().filter(t=>t.Network===e)[0].Description})});var c=this._getActivityPredecessorsList(o.Network,o.Network);r.filter(function(e){return e.Wbselement===o.Wbselement}).forEach(function(e){n=e.Networkactivity>n?e.Networkactivity:n});n=("00"+(Number(n)+1)).substr(-4);this.getModel("_activityPredecessors").setData(c);this.getModel("_networkPredecessors").setData(a);var d=JSON.parse(JSON.stringify(o));delete d.BasicstartdateLimit;this.getModel("_activity").setData(d);this.getModel("_activity").setProperty("/Apoc","0");this.getModel("_activity").setProperty("/ActivityPredecessor",o.Networkactivity);this.getModel("_activity").setProperty("/Networkactivity",n);this.getModel("_activity").setProperty("/NetworkPredecessor",o.Projectnetwork);this.getModel("_activity").setProperty("/NetworkPredecessorDescription",this.getModel("NetworkActivity").getData().filter(e=>e.Network===o.Projectnetwork)[0].Description);this.getModel("_activity").setProperty("/WorkCntr","");this.getModel("_activity").setProperty("/VendorNo","");if(!this._oADialog){this._oADialog=sap.ui.xmlfragment("epta.ps.views.project.fragments.resourceManagement.fragments.DialogActivity",this);this.getView().addDependent(this._oADialog)}this._oADialog.attachAfterClose(function(e){t._initActivityModel()});this._oADialog.open()},handleValueHelpNetworkPredecessor:function(e){var t=e.getSource().getParent().oBindingContexts;this._oInputBinding=t[Object.keys(t)[0]];if(!this._oNPDialog){this._oNPDialog=sap.ui.xmlfragment("epta.ps.views.project.fragments.resourceManagement.fragments.DialogNetworkPredecessor",this);this.getView().addDependent(this._oNPDialog)}this._oNPDialog.attachAfterClose(function(e){e.getSource().getContent()[0].removeSelections()});this._oNPDialog.open()},handleValueHelpActivityPredecessor:function(e){var t=e.getSource().getParent().oBindingContexts;this._oInputBinding=t[Object.keys(t)[0]];if(!this._oAPDialog){this._oAPDialog=sap.ui.xmlfragment("epta.ps.views.project.fragments.resourceManagement.fragments.DialogActivityPredecessor",this);this.getView().addDependent(this._oAPDialog)}this._oAPDialog.attachAfterClose(function(e){e.getSource().getContent()[0].removeSelections()});this._oAPDialog.open();this._oAPDialog.getSubHeader().getContent()[0].fireLiveChange()},handleSearchNetworkPredecessor:function(e){var t=e.getParameter("newValue");var i=[];if(t){i=new o({filters:[new o("Network",r.Contains,t)],and:false})}else{i=new o({filters:[new o("Network",r.NE,"")],and:false})}var n=e.getSource().getParent().getParent().getContent()[0].getBinding("items");n.filter([i])},handleSearchActivityPredecessor:function(e){var t=e.getParameter("newValue");var i=[];if(t){i=new o({filters:[new o("Networkactivity",r.Contains,t),new o("Description",r.Contains,t)],and:false})}else{i=new o({filters:[new o("Networkactivity",r.NE,"")],and:false})}var n=e.getSource().getParent().getParent().getContent()[0].getBinding("items");n.filter([i])},onDialogSaveWorkCenter:function(e){var t=this;if(e.getSource().toPropagate()){this.getModel("NetworkActivity").getData().forEach(function(e){if(e.Networkactivity==="")return;e.WorkCntr=t._oSelectedItem.WorkCenter;t._addChange(t._controller,"WorkCntr","/NetworkActivitySet(Projectnetwork='"+e.Projectnetwork+"',"+"Networkactivity='"+e.Networkactivity+"',"+"Wbselement='"+e.Wbselement+"')",{WorkCntr:t._oSelectedItem.WorkCenter},t.getService()._sGroupUpdateId)});this.getModel("NetworkActivity").refresh()}else{this._oInputBinding.oModel.setProperty(this._oInputBinding.sPath+"/WorkCntr",this._oSelectedItem.WorkCenter);this._addChange(this._controller,"WorkCntr","/NetworkActivitySet(Projectnetwork='"+this._oInputBinding.oModel.getProperty(this._oInputBinding.sPath+"/Projectnetwork")+"',"+"Networkactivity='"+this._oInputBinding.oModel.getProperty(this._oInputBinding.sPath+"/Networkactivity")+"',"+"Wbselement='"+this._oInputBinding.oModel.getProperty(this._oInputBinding.sPath+"/Wbselement")+"')",{WorkCntr:this._oSelectedItem.WorkCenter},this.getService()._sGroupUpdateId)}},onDialogSaveVendor:function(e){var t=this;if(e.getSource().toPropagate()){this.getModel("NetworkActivity").getData().forEach(function(e){if(e.Networkactivity==="")return;e.VendorNo=t._oSelectedItem.ID;t._addChange(t._controller,"Vendor","/NetworkActivitySet(Projectnetwork='"+e.Projectnetwork+"',"+"Networkactivity='"+e.Networkactivity+"',"+"Wbselement='"+e.Wbselement+"')",{VendorNo:t._oSelectedItem.ID},t.getService()._sGroupUpdateId)});this.getModel("NetworkActivity").refresh()}else{this._oInputBinding.oModel.setProperty(this._oInputBinding.sPath+"/VendorNo",this._oSelectedItem.ID);this._addChange(this._controller,"Vendor","/NetworkActivitySet(Projectnetwork='"+this._oInputBinding.oModel.getProperty(this._oInputBinding.sPath+"/Projectnetwork")+"',"+"Networkactivity='"+this._oInputBinding.oModel.getProperty(this._oInputBinding.sPath+"/Networkactivity")+"',"+"Wbselement='"+this._oInputBinding.oModel.getProperty(this._oInputBinding.sPath+"/Wbselement")+"')",{VendorNo:this._oSelectedItem.ID},this.getService()._sGroupUpdateId)}},onDialogSaveNetworkPredecessor:function(e){var t=this;this.getModel("_activity").setProperty("/NetworkPredecessor",this._oSelectedItem.Network);this.getModel("_activity").setProperty("/NetworkPredecessorDescription",this.getModel("NetworkActivity").getData().filter(e=>e.Network===t._oSelectedItem.Network)[0].Description);var i=this._getActivityPredecessorsList(this.getModel("_activity").getProperty("/Network"),this.getModel("_activity").getProperty("/NetworkPredecessor"));this.getModel("_activityPredecessors").setData(i);this._oSelectedItem=i[0];this.onDialogSaveActivityPredecessor({})},onDialogSaveActivityPredecessor:function(e){var t=this;var i=["__metadata","Activity","Apoc","ActivityPredecessor","BasicstartdateLimit","Description","Network","Networkactivity","NetworkPredecessor","Projectnetwork","Projectnetworkinternalid","Projectnetworkobject","UserStatus","VendorNo","Wbsdescription","Wbselement","Wbselementhierarchylevel","Wbselementobject","WorkCntr"];Object.keys(this._oSelectedItem).forEach(function(e){if(i.indexOf(e)<0){t.getModel("_activity").setProperty("/"+e,t._oSelectedItem[e])}});this.getModel("_activity").setProperty("/ActivityPredecessor",this._oSelectedItem.Networkactivity)},onSelectionChange:function(e){var t=e.getParameter("listItem").oBindingContexts;var i=t[Object.keys(t)[0]];this._oSelectedItem=i.oModel.getProperty(i.sPath)},onDialogClear:function(e){var t=this;var i=e.getSource().getContent()[0].getBinding("items");this._oSelectedItem=i.oModel.getData().filter(function(e){return e.__metadata===""})[0];if(!this._oSelectedItem){this._oSelectedItem={};Object.keys(i.oModel.getData()[0]).forEach(function(e){t._oSelectedItem[e]=""})}},onActivityCreate:function(e){var t=this;var i=JSON.parse(JSON.stringify(this.getModel("_activity").getData()));i.Basicstartdate=new Date(i.Basicstartdate);i.ActualStartDate=new Date(i.ActualStartDate);i.Forecastedstartdate=new Date(i.Forecastedstartdate);i.ActualFinishDate=new Date(i.ActualFinishDate);i.Forecastedenddate=new Date(i.Forecastedenddate);i.Basicenddate=new Date(i.Basicenddate);i.LatestStartDate=new Date(i.LatestStartDate);i.ConstraintStartDate=new Date(i.ConstraintStartDate);i.LatestFinishDate=new Date(i.LatestFinishDate);i.Datab=new Date(i.Datab);i.WorkCntr="";i.VendorNo="";i.Basicduration=i.Basicduration.toString();delete i.BasicstartdateLimit;delete i.Freedefineddate1;delete i.dealyStatus;delete i.NetworkPredecessorDescription;delete i.Addstartdate;delete i.Addfinishdate;this.getView().setBusy(true);this.getService().getModel().create("/NetworkActivitySet",i,{success:function(e){var o=t.getModel("NetworkActivity").getData();o.push(i);t.getModel("NetworkActivity").setData(o);t.getView().setBusy(false);t._onSuccessOrFailureDialog(e,"{i18n>ui5Success}","Success","{i18n>ui5SuccessText}");t.getEventBus().publish("_onProjectDetail","refresh",t.getModel("NetworkActivity").getData())},error:function(e){t.getView().setBusy(false);t._onSuccessOrFailureDialog(e,"{i18n>ui5Failure}","Error","{i18n>ui5FailureText}")}});this._oADialog.close()},_initActivityModel:function(){this.getModel("_activity").setData({});this.getModel("_activityPredecessors").setData([]);this.getModel("_networkPredecessors").setData([])},_getActivityPredecessorsList:function(e,t){var i=this.getModel("NetworkActivity").getData();var o=[];if(t!==""){e=t}i.filter(function(t){return t.Network===e&&t.Networkactivity==="0010"}).forEach(function(e,t){if(t>0)return;var i=JSON.parse(JSON.stringify(e));i.__metadata="";i.Networkactivity="";i.Activity="";o.push(i)});i.filter(function(e){return e.Network===t&&t!==""}).forEach(function(e){o.push(JSON.parse(JSON.stringify(e)))});return o},_isEditable:function(e){if(e===undefined||e===""){return false}return true}})});