sap.ui.define(["epta/ps/views/project/Project.controller","sap/ui/model/json/JSONModel","epta/ps/model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","epta/ps/ui5/m/Dialog"],function(e,t,n,o,i,s){"use strict";return e.extend("epta.ps.views.project.fragments.assignInstallationManager.AssignInstallationManager",{formatter:n,_oInputBinding:null,_oSelectedItem:null,onInit:function(){this.setModel(new t,"_dresp");this._controller=this.getView().getControllerName()},onBeforeRendering:function(){this.getModel("layout").setProperty("/footer/save",true);this.getModel("layout").setProperty("/footer/cancel",true);this.getModel("layout").setProperty("/footer/filter",false);this.getModel("layout").setProperty("/footer/enabled",true)},handleValueHelpResponsible:function(e){var t=e.getSource().getParent().oBindingContexts;this._oInputBinding=t[Object.keys(t)[0]];if(!this._oDialog){this._oDialog=sap.ui.xmlfragment("epta.ps.views.project.fragments.assignInstallationManager.fragments.DialogResponsible",this);this.getView().addDependent(this._oDialog)}this._oDialog.open()},handleLiveSearch:function(e){var t={};var n=e.getParameter("newValue");if(n){t=new o({filters:[new o("ID",i.Contains,n),new o("Name",i.Contains,n)],and:false})}else{t=[]}var s=e.getSource().getParent().getParent().getContent()[0].getBinding("items");s.filter(t)},onDialogClear:function(e){var t=this;var n=e.getSource().getContent()[0].getBinding("items");this._oSelectedItem=n.oModel.getData().filter(function(e){return e.__metadata===""})[0];if(!this._oSelectedItem){this._oSelectedItem={};Object.keys(n.oModel.getData()[0]).forEach(function(e){t._oSelectedItem[e]=""})}},onDialogSave:function(e){var t=this;var n=this._oSelectedItem;if(n===null)return;if(e.getSource().toPropagate()){this.getModel("WbselementData").getData().forEach(function(e){if(t._isEditable(e.Wbselementhierarchylevel)){e.Responsibleperson=n.ID;e.Responsiblepersonname=n.Name;t._addChange(t._controller,"Responsible","/WBSElementDataSet('"+e.Wbselement+"')",{Responsibleperson:n.ID,Responsiblepersonname:n.Name},t.getService()._sGroupUpdateId)}});this.getModel("WbselementData").refresh()}else{this._oInputBinding.oModel.setProperty(this._oInputBinding.sPath+"/Responsibleperson",n.ID);this._oInputBinding.oModel.setProperty(this._oInputBinding.sPath+"/Responsiblepersonname",n.Name);t._addChange(this._controller,"Responsible","/WBSElementDataSet('"+this._oInputBinding.oModel.getProperty(this._oInputBinding.sPath+"/Wbselement")+"')",{Responsibleperson:n.ID,Responsiblepersonname:n.Name},this.getService()._sGroupUpdateId)}},onSelectionChange:function(e){var t=e.getParameter("listItem").oBindingContexts;var n=t[Object.keys(t)[0]];this._oSelectedItem=n.oModel.getProperty(n.sPath)},_isEditable:function(e){return e===3||e===4}})});