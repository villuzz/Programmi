sap.ui.define(["epta/ps/views/project/Project.controller","sap/ui/model/json/JSONModel","epta/ps/model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,i,o,a){"use strict";return e.extend("epta.ps.views.project.fragments.purchaseRequisition.PurchaseRequisition",{formatter:i,onInit:function(){this.setModel(new t,"_rda");this._initRDAModel()},onBeforeRendering:function(){this.getModel("layout").setProperty("/footer/save",false);this.getModel("layout").setProperty("/footer/cancel",false);this.getModel("layout").setProperty("/footer/filter",true);this.getModel("layout").setProperty("/footer/enabled",true)},handleAddRDA:function(e){var t=this;var i=e.getSource().getParent().oBindingContexts;this._oSelectedItem=i[Object.keys(i)[0]];var o=this._oSelectedItem.oModel.getProperty(this._oSelectedItem.sPath);var a=JSON.parse(JSON.stringify(o));delete a.__metadata;delete a.Purchaserequisitionitem;try{a.CreatedBy=sap.ushell.Container.getService("UserInfo").getId()}catch(e){}if(a.Unit===""){a.Unit="PC"}this.getModel("_rda").setData(a);this.getModel("_rda").setProperty("/Counter",1);if(!this._oADialog){this._oADialog=sap.ui.xmlfragment("epta.ps.views.project.fragments.purchaseRequisition.fragments.DialogRDA",this);this.getView().addDependent(this._oADialog)}this._oADialog.attachAfterClose(function(e){t._initRDAModel()});this._oADialog.open()},onRDACreate:function(e){var t=this;var i=JSON.parse(JSON.stringify(this.getModel("_rda").getData()));i.Creationdate=new Date;this.getView().setBusy(true);this.getService().getModel().create("/PurReqSet",i,{success:function(e){var o=t.getModel("PurReq").getData();o.push(i);t.getModel("PurReq").setData(o);t.getView().setBusy(false);t._onSuccessOrFailureDialog(e,"{i18n>ui5Success}","Success","{i18n>ui5SuccessText}")},error:function(e){t.getView().setBusy(false);t._onSuccessOrFailureDialog(e,"{i18n>ui5Failure}","Error","{i18n>ui5FailureText}")}});this._oADialog.close()},handleValueHelpVendor:function(e){if(!this._oVDialog){this._oVDialog=sap.ui.xmlfragment("epta.ps.views.project.fragments.purchaseRequisition.fragments.DialogVendor",this);this.getView().addDependent(this._oVDialog)}this._oVDialog.attachAfterClose(function(e){e.getSource().getContent()[0].removeSelections()});this._oVDialog.open()},handleSearchVendor:function(e){var t=e.getParameter("newValue");var i=[];if(t){i=new o({filters:[new o("ID",a.Contains,t),new o("Name",a.Contains,t)],and:false})}var n=e.getSource().getParent().getParent().getContent()[0].getBinding("items");n.filter([i])},onSelectionChangeVendor:function(e){var t=e.getParameter("listItem").oBindingContexts;var i=t[Object.keys(t)[0]];this.getModel("_rda").setProperty("/Vendor",i.oModel.getProperty(i.sPath+"/ID"));this.getModel("_rda").setProperty("/VendorName",i.oModel.getProperty(i.sPath+"/Name"))},handleValueHelpCurrency:function(e){if(!this._oCDialog){this._oCDialog=sap.ui.xmlfragment("epta.ps.views.project.fragments.purchaseRequisition.fragments.DialogCurrency",this);this.getView().addDependent(this._oCDialog)}this._oCDialog.attachAfterClose(function(e){e.getSource().getContent()[0].removeSelections()});this._oCDialog.open()},handleSearchCurrency:function(e){var t=e.getParameter("newValue");var i=[];if(t){i=new o({filters:[new o("Waers",a.Contains,t),new o("Ltext",a.Contains,t)],and:false})}var n=e.getSource().getParent().getParent().getContent()[0].getBinding("items");n.filter([i])},onSelectionChangeCurrency:function(e){var t=e.getParameter("listItem").oBindingContexts;var i=t[Object.keys(t)[0]];this.getModel("_rda").setProperty("/Currency",i.oModel.getProperty(i.sPath+"/Waers"))},handleValueHelpUoM:function(e){if(!this._oUDialog){this._oUDialog=sap.ui.xmlfragment("epta.ps.views.project.fragments.purchaseRequisition.fragments.DialogUoM",this);this.getView().addDependent(this._oUDialog)}this._oUDialog.attachAfterClose(function(e){e.getSource().getContent()[0].removeSelections()});this._oUDialog.open()},handleSearchUoM:function(e){var t=e.getParameter("newValue");var i=[];if(t){i=new o({filters:[new o("Msehi",a.Contains,t),new o("Msehl",a.Contains,t)],and:false})}var n=e.getSource().getParent().getParent().getContent()[0].getBinding("items");n.filter([i])},onSelectionChangeUoM:function(e){var t=e.getParameter("listItem").oBindingContexts;var i=t[Object.keys(t)[0]];this.getModel("_rda").setProperty("/Unit",i.oModel.getProperty(i.sPath+"/Msehi"))},_initRDAModel:function(){this.getModel("_rda").setData({})}})});