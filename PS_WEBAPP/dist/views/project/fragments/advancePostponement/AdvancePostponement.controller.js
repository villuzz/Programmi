sap.ui.define(["epta/ps/views/project/Project.controller","sap/ui/model/json/JSONModel","epta/ps/model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/format/DateFormat"],function(e,t,n,o,i,a){"use strict";return e.extend("epta.ps.views.project.fragments.advancePostponement.AdvancePostponement",{formatter:n,_oSelectedItem:null,_oInputBinding:null,_aWbselementNotEditable:[],onInit:function(){this._controller=this.getView().getControllerName()},onBeforeRendering:function(){this.getModel("layout").setProperty("/footer/save",true);this.getModel("layout").setProperty("/footer/cancel",true);this.getModel("layout").setProperty("/footer/filter",false);this.getModel("layout").setProperty("/footer/enabled",true)},handleValueHelpDate:function(e){var t=e.getSource().getParent().oBindingContexts;this._oInputBinding=t[Object.keys(t)[0]];if(!this._oDialog){this._oDialog=sap.ui.xmlfragment("epta.ps.views.project.fragments.advancePostponement.fragments.Dialog",this);this.getView().addDependent(this._oDialog)}this._oDialog.attachAfterClose(function(){e.getSource().getContent().getContent()[0].removeAllSelectedDates()});this._oDialog.open()},onDialogSave:function(e){var t=this;if(e.getSource().toPropagate()){this.getModel("WbselementData").getData().forEach(function(e){if(e.isAPEnabled&&t._oInputBinding.oModel.getProperty(t._oInputBinding.sPath+"/Wbselementhierarchylevel")===e.Wbselementhierarchylevel){e.Freedefineddate1=t._oSelectedItem;if(e.Networkactivity!==""){t._addChange(t._controller,"AdvPostDate","/WBSElementDataSet('"+e.Wbselement+"')",{Freedefineddate1:new Date(t._oSelectedItem.getTime()-t._oSelectedItem.getTimezoneOffset()*6e4)},t.getService()._sGroupUpdateId)}}});this.getModel("WbselementData").refresh()}else{this._oInputBinding.oModel.setProperty(this._oInputBinding.sPath+"/"+"Freedefineddate1",this._oSelectedItem);this._addChange(this._controller,"AdvPostDate","/WBSElementDataSet('"+this._oInputBinding.oModel.getProperty(this._oInputBinding.sPath+"/Wbselement")+"')",{Freedefineddate1:new Date(this._oSelectedItem.getTime()-this._oSelectedItem.getTimezoneOffset()*6e4)},this.getService()._sGroupUpdateId);var n=this._oInputBinding.oModel.getProperty(this._oInputBinding.sPath);if(n.Wbselementhierarchylevel===3){for(var o=0;o<this._oInputBinding.oModel.getData().length;o++){if(this._oInputBinding.oModel.getProperty("/"+o+"/Wbselementparent")===n.Wbselement){this._oInputBinding.oModel.setProperty("/"+o+"/isAPEnabled",false)}}}else if(n.Wbselementhierarchylevel===4){for(var i=0;i<this._oInputBinding.oModel.getData().length;i++){if(this._oInputBinding.oModel.getProperty("/"+i+"/Wbselement")===n.Wbselementparent){this._oInputBinding.oModel.setProperty("/"+i+"/isAPEnabled",false);break}}}}},onSelectDate:function(e){this._oSelectedItem=e.getSource().getSelectedDates()[0].getProperty("startDate")},_evaluateDateInput:function(e){var t=true;var n=this.getView().getModel("WbselementData").getData().filter(function(t){return t.Wbselement===e})[0];if(n.Wbselementhierarchylevel<=2){return false}if(n.Wbselementhierarchylevel===3){t=n.isAPEnabled;if(n.isAPEnabled){var o=this.getView().getModel("WbselementData").getData().filter(function(t){return t.Wbselementparent===e});for(var i=0;i<o.length;i++){if(o[i].Freedefineddate1!==null||!o[i].isAPEnabled){t=false;break}}}}if(n.Wbselementhierarchylevel===4){t=n.isAPEnabled;if(n.isAPEnabled){var a=this.getView().getModel("WbselementData").getData().filter(function(e){return e.Wbselement===n.Wbselementparent})[0];t=a.Freedefineddate1===null&&a.isAPEnabled}}return t}})});