sap.ui.define(["epta/ps/ui5/controller/BaseController","sap/ui/model/json/JSONModel","epta/ps/model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/Button","sap/m/Dialog","sap/m/Label","sap/m/TextArea","sap/m/MessageToast","sap/m/MessageBox"],function(e,t,a,n,s,r,i,o,l,g,u){"use strict";return e.extend("epta.ps.views.search.fragments.filters.Filters",{_oDialog:{Wbselement:undefined,SoldTo:undefined,Serialno:undefined,Responsibleperson:undefined,Iammperson:undefined,SystemStatus:undefined,UserStatus:undefined,SearchStat:undefined},onInit:function(){this.setModel(new t([]),"variants");this.getView().setModel(new sap.ui.model.json.JSONModel({}),"_flt");this.onClearFilters()},onBeforeRendering:function(){var e=this;this.setModel(new t,"Wbselement");this.setModel(new t,"SoldTo");this.setModel(new t,"ShipTo");this.setModel(new t,"Serialno");this.setModel(new t,"Responsibleperson");this.setModel(new t,"Iammperson");this.setModel(new t,"SystemStatus");this.setModel(new t,"UserStatus");this.setModel(new t,"SearchStat");this.getView().setBusy(true);this._refreshFilterData();this.getService().initPersonalizationContainer(function(t){e._updateVariantsList()})},handleValueHelpWbs:function(e){this._openDialog("Wbselement")},handleSearchWbs:function(e){var t=e.getParameter("newValue");var a=[];if(t){a=new n({filters:[new n("WBSElement",s.Contains,t),new n("Description",s.Contains,t)],and:false})}var r=e.getSource().getParent().getParent().getContent()[0].getBinding("items");r.filter([a])},handleConfirmWbs:function(e){var t=e.getParameter("listItem").oBindingContexts;var a=t[Object.keys(t)[0]];var n=a.oModel.getProperty(a.sPath);this.getModel("_flt").setProperty("/Wbselement/key",n.WBSElement);this.getModel("_flt").setProperty("/Wbselement/value",n.WBSElement);e.getSource().getParent().doClose()},handleValueHelpSoldTo:function(e){this._openDialog("SoldTo")},handleSearchSoldTo:function(e){var t=e.getParameter("newValue");var a=[];if(t){a=new n({filters:[new n("ID",s.Contains,t),new n("Name",s.Contains,t)],and:false})}var r=e.getSource().getParent().getParent().getContent()[0].getBinding("items");r.filter([a])},handleConfirmSoldTo:function(e){var t=e.getParameter("listItem").oBindingContexts;var a=t[Object.keys(t)[0]];var n=a.oModel.getProperty(a.sPath);this.getModel("_flt").setProperty("/SoldTo/key",n.ID);this.getModel("_flt").setProperty("/SoldTo/value",n.Name);e.getSource().getParent().doClose()},handleValueHelpShipTo:function(e){this._openDialog("ShipTo")},handleSearchShipTo:function(e){var t=e.getParameter("newValue");var a=[];if(t){a=new n({filters:[new n("ID",s.Contains,t),new n("Name",s.Contains,t)],and:false})}var r=e.getSource().getParent().getParent().getContent()[0].getBinding("items");r.filter([a])},handleConfirmShipTo:function(e){var t=e.getParameter("listItem").oBindingContexts;var a=t[Object.keys(t)[0]];var n=a.oModel.getProperty(a.sPath);this.getModel("_flt").setProperty("/ShipTo/key",n.ID);this.getModel("_flt").setProperty("/ShipTo/value",n.Name);e.getSource().getParent().doClose()},handleValueHelpSerialno:function(e){this._openDialog("Serialno")},handleSearchSerialno:function(e){var t=e.getParameter("newValue");var a=[];if(t){a=new n({filters:[new n("SerialNumber",s.Contains,t),new n("eqktx",s.Contains,t)],and:false})}var r=e.getSource().getParent().getParent().getContent()[0].getBinding("items");r.filter([a])},handleConfirmSerialno:function(e){var t=e.getParameter("listItem").oBindingContexts;var a=t[Object.keys(t)[0]];var n=a.oModel.getProperty(a.sPath);this.getModel("_flt").setProperty("/Serialno/key",n.SerialNumber);this.getModel("_flt").setProperty("/Serialno/value",n.eqktx);e.getSource().getParent().doClose()},handleValueHelpResponsibleperson:function(e){this._openDialog("Responsibleperson")},handleSearchResponsibleperson:function(e){var t=e.getParameter("newValue");var a=[];if(t){a=new n({filters:[new n("ID",s.Contains,t),new n("Name",s.Contains,t)],and:false})}var r=e.getSource().getParent().getParent().getContent()[0].getBinding("items");r.filter([a])},handleConfirmResponsibleperson:function(e){var t=e.getParameter("listItem").oBindingContexts;var a=t[Object.keys(t)[0]];var n=a.oModel.getProperty(a.sPath);this.getModel("_flt").setProperty("/Responsibleperson/key",n.ID);this.getModel("_flt").setProperty("/Responsibleperson/value",n.Name);e.getSource().getParent().doClose()},handleValueHelpIammperson:function(e){this._openDialog("Iammperson")},handleSearchIammperson:function(e){var t=e.getParameter("newValue");var a=[];if(t){a=new n({filters:[new n("ID",s.Contains,t),new n("Name",s.Contains,t)],and:false})}var r=e.getSource().getParent().getParent().getContent()[0].getBinding("items");r.filter([a])},handleConfirmIammperson:function(e){var t=e.getParameter("listItem").oBindingContexts;var a=t[Object.keys(t)[0]];var n=a.oModel.getProperty(a.sPath);this.getModel("_flt").setProperty("/Iammperson/key",n.ID);this.getModel("_flt").setProperty("/Iammperson/value",n.Name);e.getSource().getParent().doClose()},handleValueHelpSystemStatus:function(e){this._openDialog("SystemStatus")},handleSearchSystemStatus:function(e){var t=e.getParameter("newValue");var a=[];if(t){a=new n({filters:[new n("Status",s.Contains,t),new n("Description",s.Contains,t)],and:false})}var r=e.getSource().getParent().getParent().getContent()[0].getBinding("items");r.filter([a])},handleConfirmSystemStatus:function(e){var t=e.getParameter("listItem").oBindingContexts;var a=t[Object.keys(t)[0]];var n=a.oModel.getProperty(a.sPath);this.getModel("_flt").setProperty("/SystemStatus/key",n.Status);this.getModel("_flt").setProperty("/SystemStatus/value",n.Description);e.getSource().getParent().doClose()},handleValueHelpUserStatus:function(e){this._openDialog("UserStatus")},handleSearchUserStatus:function(e){var t=e.getParameter("newValue");var a=[];if(t){a=new n({filters:[new n("Status",s.Contains,t),new n("Description",s.Contains,t)],and:false})}var r=e.getSource().getParent().getParent().getContent()[0].getBinding("items");r.filter([a])},handleConfirmUserStatus:function(e){var t=e.getParameter("listItem").oBindingContexts;var a=t[Object.keys(t)[0]];var n=a.oModel.getProperty(a.sPath);this.getModel("_flt").setProperty("/UserStatus/key",n.Status);this.getModel("_flt").setProperty("/UserStatus/value",n.Description);e.getSource().getParent().doClose()},handleBasicStartDateChange:function(e){},handleValueHelpSearchStat:function(e){this._openDialog("SearchStat")},handleSearchSearchStat:function(e){var t=e.getParameter("newValue");var a=[];if(t){a=new n({filters:[new n("Status",s.Contains,t),new n("Description",s.Contains,t)],and:false})}var r=e.getSource().getParent().getParent().getContent()[0].getBinding("items");r.filter([a])},handleConfirmSearchStat:function(e){var t=e.getParameter("listItem").oBindingContexts;var a=t[Object.keys(t)[0]];var n=a.oModel.getProperty(a.sPath);this.getModel("_flt").setProperty("/SearchStat/key",n.Statusproject);this.getModel("_flt").setProperty("/SearchStat/value",n.Descrstatus);e.getSource().getParent().doClose()},onClearFilters:function(){this.getModel("_flt").setData({Wbselement:{key:"",value:""},SoldTo:{key:"",value:""},ShipTo:{key:"",value:""},Serialno:{key:"",value:""},Responsibleperson:{key:"",value:""},Iammperson:{key:"",value:""},SystemStatus:{key:"",value:""},UserStatus:{key:"",value:""},SearchStat:{key:"",value:""},Basicstartdate:null,BasicstartdateTo:null})},onSearch:function(e){var t=this;this.getEventBus().publish("_onSearch","start",e);this.getView().byId("fltPanel").setExpanded(false);var a=[];var r="";var i="";r="Wbselement";i=t.getView().getModel("_flt").getProperty("/"+r+"/key").trim();if(i!==""){a.push(new n(r,s.EQ,i.toString()))}r="SoldTo";i=t.getView().getModel("_flt").getProperty("/"+r+"/key").trim();if(i!==""){a.push(new n(r+"/PartnerId",s.EQ,i.toString()))}r="ShipTo";i=t.getView().getModel("_flt").getProperty("/"+r+"/key").trim();if(i!==""){a.push(new n(r+"/PartnerId",s.EQ,i.toString()))}r="Serialno";i=t.getView().getModel("_flt").getProperty("/"+r+"/key").trim();if(i!==""){a.push(new n(r,s.EQ,i.toString()))}r="Responsibleperson";i=t.getView().getModel("_flt").getProperty("/"+r+"/key").trim();if(i!==""){a.push(new n(r,s.EQ,i.toString()))}r="Iammperson";i=t.getView().getModel("_flt").getProperty("/"+r+"/key").trim();if(i!==""){a.push(new n(r,s.EQ,i.toString()))}r="SystemStatus";i=t.getView().getModel("_flt").getProperty("/"+r+"/key").trim();if(i!==""){a.push(new n(r+"/StatusId",s.EQ,i.toString()))}r="UserStatus";i=t.getView().getModel("_flt").getProperty("/"+r+"/key").trim();if(i!==""){a.push(new n(r+"/StatusId",s.EQ,i.toString()))}r="SearchStat";i=t.getView().getModel("_flt").getProperty("/"+r+"/key").trim();if(i!==""){a.push(new n("Statusproject",s.EQ,i.toString()))}r="Basicstartdate";i=t.getView().getModel("_flt").getProperty("/"+r);var o=t.getView().getModel("_flt").getProperty("/"+r+"To");if(i&&o){var l=new Date(i.getTime()-i.getTimezoneOffset()*6e4);var g=new Date(o.getTime()-o.getTimezoneOffset()*6e4);a.push(new n(r,s.BT,l,g))}this.getService().readProjectSet({filters:a,success:function(e){t.getEventBus().publish("_onSearch","end",e)}})},onCloseVariantList:function(e){this.byId("DialogVariantList").close()},onListVariant:function(e){var t=this.byId("tableVariant").getBinding("items");t.filter().refresh();this.byId("DialogVariantList").open()},onCloseVariant:function(e){this.byId("DialogVariant").close()},onPressVariant:function(e){this.getView().byId("VariantName").setValue("");var t=this.byId("DialogVariant");t.open()},onSaveVariant:function(e){var t={};t.Name=this.getView().byId("VariantName").getValue();if(t.Name.includes(" ")){u.alert("Space not permitted")}else if(t.Name===""){u.alert("Insert Name")}else{t.Filter=JSON.stringify(this.getModel("_flt").getData());var a=this.getService().getModel();a.create("/VariantSet",t,{success:function(e,t){},error:function(e,t){var a=JSON.parse(e.responseText);u.alert(a.error.message.value);this.PopulateError("Error",a.error.message.value)}.bind(this)});this.byId("DialogVariant").close()}},onDeleteVariantList:function(e){var t="/VariantSet(Name='"+e.getSource().getBindingContext().getObject().Name+"')";var a=this.getService().getModel();a.remove(t,{success:function(e,t){var a=this.byId("tableVariant").getBinding("items");a.filter().refresh()}.bind(this),error:function(e,t){var a=JSON.parse(e.responseText);u.alert(a.error.message.value)}})},onVariantPress:function(e){var t=JSON.parse(e.getSource().getBindingContext().getObject().Filter);if(t.Basicstartdate!==null){t.Basicstartdate=new Date(t.Basicstartdate)}else{t.Basicstartdate=null}if(t.BasicstartdateTo!==null){t.BasicstartdateTo=new Date(t.BasicstartdateTo)}else{t.BasicstartdateTo=null}this.getModel("_flt").setData(t);this.byId("DialogVariantList").close()},onSubmitDialog:function(){var e=this;if(!this._oADialog){this._oADialog=sap.ui.xmlfragment("epta.ps.views.search.fragments.filters.fragments.DialogVariant",this);this.getView().addDependent(this._oADialog)}this._oADialog.attachAfterClose(function(t){e._updateVariantsList()});this._oADialog.open()},onVariantSelect:function(e){var t=this;if(e.mParameters.value===""){return}this.getModel("variants").getData().forEach(function(a){if(a.key===e.getSource().getSelectedItem().getProperty("key")){if(a.filters.Basicstartdate!==""){a.filters.Basicstartdate=a.filters.Basicstartdate.substr(0,10)}if(a.filters.BasicstartdateTo!==""){a.filters.BasicstartdateTo=a.filters.BasicstartdateTo.substr(0,10)}t.getModel("_flt").setData(a.filters)}})},_updateVariantsList:function(){this.getModel("variants").setData(this.getService().getVariants())},_openDialog:function(e){if(!this._oDialog[e]){this._oDialog[e]=sap.ui.xmlfragment("epta.ps.views.search.fragments.filters.fragments.Dialog"+e,this);this.getView().addDependent(this._oDialog[e])}this._oDialog[e].open()},_refreshFilterData:function(){var e=this;this.getView().setBusy(true);this.getService().readFilters({success:function(t){var a={Wbselement:[{CompanyCode:"",WBSElement:"",Description:""}].concat(t.__batchResponses[0].data.results),SoldTo:[{ID:"",Name:"",PurchGrp:""}].concat(t.__batchResponses[1].data.results),ShipTo:[{ID:"",Name:"",PurchGrp:""}].concat(t.__batchResponses[2].data.results),Serialno:[{SerialNumber:"",eqktx:""}].concat(t.__batchResponses[3].data.results),Iammperson:[{ID:"",Name:""}].concat(t.__batchResponses[4].data.results),SystemStatus:[{ID:"",Status:"",Description:""}].concat(t.__batchResponses[5].data.results),UserStatus:[{ID:"",Status:"",Description:""}].concat(t.__batchResponses[6].data.results),Responsibleperson:[{ID:"",Name:""}].concat(t.__batchResponses[7].data.results),SearchStat:[{Statusproject:"",Descrstatus:""}].concat(t.__batchResponses[8].data.results)};Object.keys(a).forEach(function(t){e.getModel(t).setData(a[t])});e.getView().setBusy(false)},error:function(t){e.getView().setBusy(false)}})}})});