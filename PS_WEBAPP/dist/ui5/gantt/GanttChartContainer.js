sap.ui.define(["sap/gantt/GanttChartContainer","epta/ps/model/formatter","epta/ps/model/models","sap/ui/model/json/JSONModel","sap/ui/export/library","sap/ui/export/Spreadsheet"],function(e,t,o,r,i,a){"use strict";var n=i.EdmType;return e.extend("epta.ps.ui5.gantt.GanttChartContainer",{metadata:{properties:{showTitle:{type:"boolean",defaultValue:false}}},init:function(){e.prototype.init.apply(this);this.setLegendContainer(this._createLegendContainer());this.setToolbarSchemes(this._createToolbarSchemes());this.setContainerLayouts(this._createContainerLayouts());this.setContainerLayoutKey("epta.ps.gantt_layout");this.addCustomToolbarItem(this._createCustomToolbar())},onBeforeRendering:function(){var e=this;this._oTable=this.getAggregation("ganttCharts")[0].getAggregation("_selectionPanel");var t=[];if(o.getFromStorage(this._oTable.getId())){t=o.getFromStorage(this._oTable.getId());t.forEach(function(t){e._changeColumnVisibility(t)})}},_createToolbarSchemes:function(){var e=[new sap.gantt.config.ToolbarScheme({key:"GLOBAL_TOOLBAR",customToolbarItems:new sap.gantt.config.ToolbarGroup({position:"R2",overflowPriority:sap.m.OverflowToolbarPriority.High}),timeZoom:new sap.gantt.config.ToolbarGroup({position:"R4",overflowPriority:sap.m.OverflowToolbarPriority.NeverOverflow}),toolbarDesign:sap.m.ToolbarDesign.Transparent}),new sap.gantt.config.ToolbarScheme({key:"LOCAL_TOOLBAR"})];return e},_createContainerLayouts:function(){var e=[new sap.gantt.config.ContainerLayout({key:"epta.ps.gantt_layout",text:"Gantt Layout",toolbarSchemeKey:"GLOBAL_TOOLBAR"})];return e},_createLegendContainer:function(){var e="#FAC364";var t="#5CBAE5";var o="#848F94";var r=sap.ui.getCore().getConfiguration().getTheme()==="sap_hcb"?"white":"";var i="basicDates";var a="forecastDates";var n="relationship";var s=new sap.gantt.legend.LegendContainer({legendSections:[new sap.m.Page({title:"legend",content:[new sap.ui.core.HTML({content:"<div width='100%' height='50%' style='margin-top: 25px'><svg width='180px' height='160px'><g>"+"<g style='display: block;'>"+"<g><rect x='"+(sap.ui.getCore().getConfiguration().getRTL()?"155":"25")+"' y='2' width='20' height='20' fill="+t+" style='stroke: "+t+"; stroke-width: 2px;'></rect>"+"<text x='"+(sap.ui.getCore().getConfiguration().getRTL()?"125":"55")+"' y='16' font-size='0.875rem' fill="+r+">"+i+"</text></g>"+"<g style='display: block;'>"+"<g><rect x='"+(sap.ui.getCore().getConfiguration().getRTL()?"155":"25")+"' y='32' width='20' height='20' fill="+e+" style='stroke: "+e+"; stroke-width: 2px;'></rect>"+"<text x='"+(sap.ui.getCore().getConfiguration().getRTL()?"125":"55")+"' y='46' font-size='0.875rem' fill="+r+">"+a+"</text></g>"+"<g style='display: block;'>"+"<g><rect x='"+(sap.ui.getCore().getConfiguration().getRTL()?"155":"25")+"' y='72' width='20' height='1' fill="+o+" style='stroke: "+o+"; stroke-width: 1px;'></rect>"+"<text x='"+(sap.ui.getCore().getConfiguration().getRTL()?"125":"55")+"' y='76' font-size='0.875rem' fill="+r+">"+n+"</text></g>"+"</g></g></svg></div>"})]})]});return s},_createCustomToolbar:function(){var e=this;return new sap.m.Toolbar({content:[new sap.m.ToolbarSeparator,new sap.m.Button({icon:"sap-icon://table-column",press:function(){if(!e._popover){e._createPopover()}e._popover.getContent()[0].setModel(new r(e._getColumns()));e._popover.openBy(this)}}),new sap.m.ToolbarSpacer({width:"10px"}),new sap.m.ToolbarSeparator]})},exportSpreadsheet:function(e,t,o){return new sap.ui.export.Spreadsheet(e).build().catch(o?o.bind(this):null).then(t?t.bind(this):null)},exportExcel:function(e){var t=this._oTable.getBinding("rows");return t.getLength()<1?null:this.exportSpreadsheet({workbook:{columns:this.createColumnConfig(),hierarchyLevel:"Level"},dataSource:{type:"OData",useBatch:true,serviceUrl:t.getModel().sServiceUrl,headers:t.getHeaders?t.getHeaders():null,dataUrl:t.getDownloadUrl?t.getDownloadUrl():null,count:t.getLength(),sizeLimit:5},worker:true})},createColumnConfig:function(){var e=this.getModel("i18n").getResourceBundle();var t=[];t.push({label:e.getText("tblWBE"),property:"Wbselement",type:n.String});return t},_createPopover:function(){var e=this;var t=new sap.m.StandardListItem({title:"{desc}",selected:{path:"visible"}});this._popover=new sap.m.Popover({placement:sap.m.PlacementType.Bottom,title:"{i18n>ui5GanttPopoverCols}",showHeader:true,verticalScrolling:true,horizontalScrolling:false,content:[new sap.m.List({inset:true,mode:"MultiSelect",select:function(t){var o=t.getParameter("listItem").getBindingInfo("selected").binding.getContext();e._changeColumnVisibility(o.oModel.getProperty(o.sPath))}}).bindAggregation("items","/",t)]}).addStyleClass("eptaSettinsgsPopover")},_getColumns:function(){var e=[];this._oTable.getColumns().forEach(function(t){if(t.getAggregation("label").getProperty("text")!==""){e.push({id:t.getId(),desc:t.getAggregation("label").getProperty("text"),visible:t.getVisible()})}});o.setIntoStorage(this._oTable.getId(),e);return e},_changeColumnVisibility:function(e){var t=this._oTable.getColumns().filter(function(t){return e.id===t.getId()})[0];if(t){t.setVisible(e.visible)}var r=o.getFromStorage(this._oTable.getId());for(var i=0;i<r.length;i++){if(!t){r.splice(i,1);break}else if(r[i].id===e.id){r[i].visible=e.visible;break}}o.setIntoStorage(this._oTable.getId(),r)},renderer:{}})});